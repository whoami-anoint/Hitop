name: Auto Merge Dev to Main

on:
  schedule:
    # cron: '*/10 * * * *'  # Schedule every 10 minutes

jobs:
  merge:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2
        with:
          ref: dev

      - name: Create Pull Request
        id: create_pr
        uses: peter-evans/create-pull-request@v3
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          branch: main
          commit-message: Automated PR from dev to main
          title: Automated PR from dev to main
          body: This PR was automatically generated by GitHub Actions.
          base: main

      - name: Merge Pull Request
        if: steps.create_pr.outputs.pull-request-number != ''
        run: |
          echo "Pull Request created. Merging..."
          curl \
            -X PUT \
            -H "Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}" \
            -H "Accept: application/vnd.github.v3+json" \
            https://api.github.com/repos/${{ github.repository }}/pulls/${{ steps.create_pr.outputs.pull-request-number }}/merge
